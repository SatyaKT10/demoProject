<div class="page-width">
  <div class="loader-div">
    <div class="loader"></div>
  </div>
  <div class="order__confirm-page">
    <div class="order__confirm-container order-success">
      <div class="order__confirm-icon-wrapper">
        <div class="order__confirm-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" fill="none">
            <path d="M30 0L33.4353 1.7078L37.1795 0.871746L40.1062 3.35204L43.9417 3.43632L46.1898 6.54496L49.8937 7.54468L51.3326 11.101L54.6895 12.9581L55.2355 16.7554L58.0505 19.3619L57.6718 23.1795L59.7813 26.3839L58.5 30L59.7813 33.6161L57.6718 36.8205L58.0505 40.6381L55.2355 43.2446L54.6895 47.0419L51.3326 48.899L49.8937 52.4553L46.1898 53.455L43.9417 56.5637L40.1062 56.648L37.1795 59.1283L33.4353 58.2922L30 60L26.5647 58.2922L22.8205 59.1283L19.8938 56.648L16.0583 56.5637L13.8102 53.455L10.1063 52.4553L8.66744 48.899L5.31048 47.0419L4.7645 43.2446L1.94951 40.6381L2.32816 36.8205L0.218733 33.6161L1.5 30L0.218733 26.3839L2.32816 23.1795L1.94951 19.3619L4.7645 16.7554L5.31048 12.9581L8.66744 11.101L10.1063 7.54468L13.8102 6.54496L16.0583 3.43632L19.8938 3.35204L22.8205 0.871746L26.5647 1.7078L30 0Z" fill="#00BAC6"/>
            <path d="M40.6697 21L26.2747 35.395L20.8025 29.9228L19 31.7253L26.2747 39L42.4722 22.8025L40.6697 21Z" fill="white"/>
          </svg>
        </div>
        <div class="order__confirm-icon-text">Order Confirmed</div>
      </div>
      <div class="order__confirm-content-wrapper">
        <div class="order-content">Order ID #<span class="order-id"></span></div>
        <div class="payment-content">Payment ID #<span class="payment-id"></span></div>
      </div>
      <div class="order__confirm-sms">
        Order Confirmation has been sent via SMS
      </div>
      <div class="back-to-home">
        <a href="https://aqualensb2b.com/">Back to Home</a>
      </div>
    </div>
    <div class="order__confirm-container order-failure hide">
      <div class="order__confirm-icon-wrapper">
        <div class="order__confirm-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" fill="none">
            <path d="M30 0L33.4353 1.7078L37.1795 0.871746L40.1062 3.35204L43.9417 3.43632L46.1898 6.54496L49.8937 7.54468L51.3326 11.101L54.6895 12.9581L55.2355 16.7554L58.0505 19.3619L57.6718 23.1795L59.7813 26.3839L58.5 30L59.7813 33.6161L57.6718 36.8205L58.0505 40.6381L55.2355 43.2446L54.6895 47.0419L51.3326 48.899L49.8937 52.4553L46.1898 53.455L43.9417 56.5637L40.1062 56.648L37.1795 59.1283L33.4353 58.2922L30 60L26.5647 58.2922L22.8205 59.1283L19.8938 56.648L16.0583 56.5637L13.8102 53.455L10.1063 52.4553L8.66744 48.899L5.31048 47.0419L4.7645 43.2446L1.94951 40.6381L2.32816 36.8205L0.218733 33.6161L1.5 30L0.218733 26.3839L2.32816 23.1795L1.94951 19.3619L4.7645 16.7554L5.31048 12.9581L8.66744 11.101L10.1063 7.54468L13.8102 6.54496L16.0583 3.43632L19.8938 3.35204L22.8205 0.871746L26.5647 1.7078L30 0Z" fill="#00BAC6"/>
            <path d="M40.6697 21L26.2747 35.395L20.8025 29.9228L19 31.7253L26.2747 39L42.4722 22.8025L40.6697 21Z" fill="white"/>
          </svg>
        </div>
        <div class="order__confirm-icon-text">Order Failed</div>
      </div>
      <div class="order__info">
        <div id="failure_message"></div>
      </div>
      <div class="back-to-home">
        <a href="https://aqualensb2b.com/">Back to Home</a>
      </div>
    </div>
  </div>
</div>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Quattrocento&display=swap');
  
  .order__confirm-page{
    height: 100vh;
    padding-top: 52px;
    text-align: center;
  }
  .order__confirm-icon-text {
    font-family: Quattrocento;
    font-style: normal;
    font-weight: bold;
    font-size: 24px;
    line-height: 27px;
    color: #474747;
    padding-top: 14px;
    margin-bottom: 40px;
  }
  .order-content {
    font-family: Poppins;
    font-style: normal;
    font-weight: 600;
    font-size: 18px;
    line-height: 27px;
    color: #333333;
    padding-bottom: 8px;
  }
  .payment-content {
    font-family: Poppins;
    font-style: normal;
    font-weight: normal;
    font-size: 14px;
    line-height: 21px;
    color: #333333;
    margin-bottom: 80px;
  }
  .order__confirm-sms {
    font-family: Poppins;
    font-style: normal;
    font-weight: 500;
    font-size: 14px;
    line-height: 21px;
    color: #666666;
    padding: 0 25px;
    margin-bottom: 212px;
  }
  .back-to-home a{
    font-family: Poppins;
    font-style: normal;
    font-weight: 600;
    font-size: 16px;
    line-height: 24px;
    text-decoration: underline;
    color: #00BAC6;
  }
  .order-failure .order__confirm-icon-wrapper {
    margin-bottom: 400px;
  }
  .loader-div {
    background: #000;
    top: 62px;
    left: 0;
    position: fixed;
    width: 100%;
    height: 100vh;
    z-index: 991;
    opacity: 85%;
  }
  .loader {
	height: 50px;
    width: 50px;
    border: 5px solid #333;
    border-radius: 50%;
    border-top: 5px solid #999;
    opacity: 1;
    margin: 0 auto;
    margin-top: 60%;
    animation-name: spin;
    animation-duration: 1000ms;
    animation-iteration-count: infinite;
    animation-timing-function: linear;
  }
  @keyframes spin {
    from {
      transform:rotate(0deg);
    }
    to {
      transform:rotate(360deg);
    }
  }
  .no-scroll{
    overflow: hidden;
  }
</style>

<script> 
  var myInterval;
  let cartId = sessionStorage.getItem("cartIdB2C");
  let customerDataB2C = JSON.parse(sessionStorage.getItem("customerDataB2C"));
  let customerIdB2C = sessionStorage.getItem("customerIdB2C");
  let customerId = '{{ customer.id }}';
  
  const thankyouVariable = JSON.parse(sessionStorage.getItem('thankyouVariable'));
  const {endTransaction,followUp,paymentId,orderTotal,categoryType} = thankyouVariable;

  function ajaxCall(){   
    let settings = {
      url : `https://subscriber.aqualens.in/api/v1/vsm/order-status/${cartId}`,
      method: "GET"
    }
    $.ajax(settings).done(function(data){
      if((data.data.order_status).includes("created")){
        $('.loader-div').hide();
        clearInterval(myInterval);
        
        $('body').removeClass("no-scroll");
        $('.order-id').html(`${data.data.order.lenskart_order_id}`);
        $('.payment-id').html(`${data.data.payment_id}`);
        
        
        let order_id = `${data.data.order.lenskart_order_id}`;
        
        customerDataB2C.cart_id = cartId;
        
        let orderDataB2B = {     
          "customer_id": customerId,
          "b2c_customer_id": customerIdB2C,
          "b2c_order_id": order_id,
          "amount": orderTotal,
          "b2c_customer_data": customerDataB2C,
          "product_type": categoryType,
        };
        
        
        let settings = {
          url : baseURL+"/api/b2c/order",
          method: "POST",
          data: orderDataB2B,
        }
        $.ajax(settings).done(function(response){
          console.log(response);
        })
        .fail(function (error) {
          console.log(error);
        });

//         if(endTransaction == true){
//         }
      } 
      else if((data.data.order_status).includes("failure")){
        $('.loader-div').hide();
        $('.order-success').addClass("hide");
        $('.order-failure').removeClass("hide");
        $('body').removeClass("no-scroll");
        clearInterval(myInterval);
        $("#failure_message").html(`<h4>Order processing failed.<br>Any amount deducted will be refunded.<br>Refund ID: ${data.data.payment_refund_id}</h4>`);
      }          
    })
    .fail(function(){
      $('.loader-div').hide();
      $('.order-success').addClass("hide");
      $('.order-failure').removeClass("hide");
      $('body').removeClass("no-scroll");
      clearInterval(myInterval);
      $("#failure_message").html(`<h4>Order processing failed.<br>Any amount deducted will be refunded.</h4>`);
    })
  }

//   $(function(){
//     $('#cartId').html(`${cartId}`);
//     $('#paymentId').html(`${paymentId}`);
//   })

  $(document).ready(function () {
    var i = 60;
    myInterval = setInterval(function(){
      i--;
      if(i < 10){
//         $(".failure").show();
//         $('.payment-info').show();
        i = 60;
      }
      ajaxCall();
    }, 1000);
    $('body').addClass("no-scroll")
  })
</script>
